<p align="center">
  <img src="https://i.imgur.com/eo4NW2A.jpg" width="154">
  <h1 align="center">ZozhMarket</h1>
  <p align="center">A telegram bot that implements work with <b>database</b>
    through the operation of a store of healthy food and making orders.</p>
  <p align="center">
	<a href="https://www.python.org/">
    <img src="https://img.shields.io/badge/bulid with-Python3-ff1493.svg" />
    </a>
	<a href="https://www.postgresql.org/">
	<img src="https://img.shields.io/badge/bulid with-postgresql-8A2BE2.svg">
    </a>
  </p>
</p>


# LAB-2
## Выполнили:
**19 ПИ - 2**
* ***Конина Татьяна*** 
* ***Ожиганова Полина***

### Придумать свою предметную область и продумать схему БД для неё.
	В качестве предметной области был выбран магазин полезных продуктов --> "ЗОЖМаркет".
	
	Правая таблица (orders):
	    * id - id заказа (PRIMARY KEY), генерируется автоматически;
        * date - дата создания заказа;
        * quantity - кол-во штук заказанного товара;
        * product_id - id заказанного товара;
        * sum - общая сумма;
        * buyer - id покупателя;
        
    Вторая таблица (users):
        * telegram_id - id пользователя (PRIMARY KEY), парсится ботом; 
        * fio - ФИО покупателя (либо просто имя);
        * address - адрес доставки;
        * phone - телефонный номер;
        
    Третья таблица (products):
        * id - id товара (PRIMARY KEY), генерируется автоматически;
        * flavour - вкус;
        * price - цена за 1 шт.;
        * name - наименование товара;
        * img_link - картинка товара;
        * category - категория товара;
    
    
Схема БД:
    
<p align="left">
  <img src="https://i.imgur.com/yzoLjrm.jpeg" width="600">
</p>

### Критерии к БД:
**[1]** БД должна быть в третьей нормальной форме или выше;

* Данная БД представлена в третьей нормальной форме,  
так как уникальными ключами являются только id а каждой из таблиц,  
остальные колонки не уникальны и не играют роль ключа в таблице.  
 
**[2]** Минимальное количество таблиц – две;

* Созданная база данных состоит из 3х таблиц: заказы, пользователи, товары.  

**[3]** Все подключения из GUI должны осуществляться выделенным, не root, пользователем;

* При создании контейнера с базой данных у нас создаётся юзер **bot_postgres** (с паролем).  
Подключаемся к базе данных по host: db(название контейнера) и портом :5432  
Бот собирается с помощью git-hub actions и docker-compose, который пушится на удаленный сервер  
и работает там.  

**[4]** Должен существовать как минимум один индекс, 
    созданный вами по выбранному текстовому не ключевому полю;

* В качестве индекса была выбрана колонка "категория" товара.  
Так как магазин будет расширяться и поиск будет запрашиваться часто  
среди разнообразных категорий, то он должен быть быстрым.  

* Объявление индекса:

```sql
CREATE INDEX category_index ON products (category);
```

**[5]** В одной из таблиц должно присутствовать поле, заполняемое/изменяемое только триггером 
(например, «общая стоимость бронирования» в таблице «бронирования», которое автоматически 
высчитывается при добавлении/изменении/удалении билетов, входящих в это бронирование)

* Триггером заполнялось и изменялось поле *fio* в таблице *users*.  
Триггер был объявлен следующим образом:

```sql
CREATE TRIGGER trigger_name
BEFORE INSERT ON users FOR EACH ROW
EXECUTE PROCEDURE trigger_for_name()
```

### Реализовать программу GUI со следующим функционалом:
**[1]** Создание базы данных (важно(!) именно create database, а не только create table)  
**[2]** Удаление базы данных  
**[3]** Вывод содержимого таблиц  
**[4]** Очистка(частичная - одной, и полная - всех) таблиц  
**[5]** Добавление новых данных  
**[6]** Поиск по заранее выбранному (вами) текстовому не ключевому полю  
**[7]** Обновление кортежа  
**[8]** Удаление по заранее выбранному текстовому не ключевому полю  
**[9]** Удаление конкретной записи, выбранной пользователем  
**[10]** Все функции должны быть реализованы как хранимые процедуры.  

Из GUI вызываются только хранимые функции.  
    
### Реализация
    Мы решили написать кнопочного telegram-бота, где пользователи смогут:
     * заказывать еду online;
     * просматривать заказы;
     * удалять все заказы;
     * просматривать корзину;
     * изменять кол-во определнного товара к корзине;
     * менять свое имя в заказе;
     * определять адрес доставки с помощью Yandex geo API;
     
Все манипуляции с postgreSQL можно посмотреть в **bot/utils/db_api/postgresql.py** файле.

### Демонтрация работы telegram-бота
**[bot-work example](https://drive.google.com/file/d/1LEq-mHIxHaQilzlIzLzvY1BkLXL564hq/view) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**

### Ссылка на telegram-бота
**[@Zozhmarketbot](https://t.me/Zozhmarketbot) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**